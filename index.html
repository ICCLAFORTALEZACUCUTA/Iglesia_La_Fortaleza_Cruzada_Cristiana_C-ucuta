            // --- Event Creation Login/Form Logic ---
            const addEventBtn = document.getElementById('addEventBtn'); // Ya existe
            const eventModal = document.getElementById('eventModal'); // ID del modal de eventos
            const eventLoginFormContainer = document.getElementById('eventLoginFormContainer'); // ID del contenedor de login de eventos
            const eventCreationFormContainer = document.getElementById('eventCreationFormContainer'); // ID del contenedor del formulario de creación de eventos
            const eventLoginForm = document.getElementById('eventLoginForm'); // ID del formulario de login de eventos
            const createEventForm = document.getElementById('createEventForm'); // ID del formulario de creación de eventos
            const eventLoginMessage = document.getElementById('eventLoginMessage'); // ID del mensaje de login de eventos
            const eventMessage = document.getElementById('eventMessage'); // ID del mensaje de creación de evento
            const displayMessage = document.getElementById('displayMessage'); // ID del mensaje de creación de evento


            if (addEventBtn) {
                addEventBtn.addEventListener('click', () => {
                    // Reset form visibility and messages
                    eventLoginFormContainer.style.display = 'block';
                    eventCreationFormContainer.style.display = 'none';
                    eventLoginMessage.style.display = 'none';
                    eventMessage.style.display = 'none';
                    eventLoginForm.reset();
                    createEventForm.reset();
                    CONFIG.currentUserEvent = null; // Clear user for this modal on open

                    showModal('eventModal'); // Muestra el modal de eventos
                });
            }

            if (eventLoginForm) {
                eventLoginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const username = eventLoginForm.username.value;
                    const password = eventLoginForm.password.value;

                    eventLoginMessage.style.display = 'none'; // Hide previous message

                    const user = CONFIG.USERS[username]; // Obtener el usuario de la configuración global

                    if (user && user.password === password) {
                        // Verificar si el rol tiene permiso para crear eventos
                        if (['pastor', 'miembro'].includes(user.role)) {
                            CONFIG.currentUserEvent = user; // Almacenar el usuario logueado para este modal
                            displayMessage(eventLoginMessage, `¡Bienvenido, ${user.name}! Acceso concedido.`, 'success');

                            // Simular carga para mejor UX
                            // showFullScreenLoading(true); // Si tienes esta función global

                            setTimeout(() => {
                                // showFullScreenLoading(false); // Si tienes esta función global
                                eventLoginFormContainer.style.display = 'none';
                                eventCreationFormContainer.style.display = 'block';
                                eventMessage.style.display = 'none'; // Ensure event message is hidden
                            }, 1000); // Simulate login delay
                        } else {
                            displayMessage(eventLoginMessage, 'Tu rol no tiene permisos para crear eventos.', 'danger');
                        }
                    } else {
                        displayMessage(eventLoginMessage, 'Usuario o contraseña incorrectos.', 'danger');
                    }
                });
            }

            if (createEventForm) {
                createEventForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    eventMessage.style.display = 'none'; // Hide previous message

                    // Permisos basados en el usuario logueado en este modal
                    if (!CONFIG.currentUserEvent || !['pastor', 'miembro'].includes(CONFIG.currentUserEvent.role)) {
                        displayMessage(eventMessage, 'No tienes permisos para crear eventos.', 'danger');
                        return;
                    }

                    // showFullScreenLoading(true); // Si tienes esta función global

                    // Recopilar datos del formulario de evento
                    const formData = new FormData(createEventForm);
                    const eventData = {
                        action: 'addEvent', // Acción para tu Apps Script
                        username: CONFIG.currentUserEvent.name, // Quién está creando el evento
                        role: CONFIG.currentUserEvent.role,
                        eventTitle: formData.get('eventTitle'),
                        eventDate: formData.get('eventDate'),
                        eventEndDate: formData.get('eventEndDate'),
                        eventLocation: formData.get('eventLocation'),
                        eventCardDescription: formData.get('eventCardDescription'),
                        eventGeneralDescription: formData.get('eventGeneralDescription')
                    };

                    // Validación de fechas
                    if (eventData.eventEndDate && eventData.eventDate && new Date(eventData.eventEndDate) < new Date(eventData.eventDate)) {
                        displayMessage(eventMessage, 'La fecha de fin no puede ser anterior a la fecha de inicio.', 'danger');
                        // showFullScreenLoading(false); // Ocultar carga si hay error
                        return;
                    }

                    displayMessage(eventMessage, 'Creando evento...', 'info');

                    // Enviar datos a Google Apps Script
                    await sendDataToAppsScript(eventData, eventMessage);

                    // showFullScreenLoading(false); // Ocultar carga

                    createEventForm.reset(); // Limpiar el formulario después de enviar
                    hideModal('eventModal'); // Cerrar el modal después de una creación exitosa
                });
            }


            // --- Sermon Upload Login/Form Logic ---
            const addSermonBtn = document.getElementById('addSermonBtn');
            const sermonAuthModal = document.getElementById('sermonAuthModal');
            const loginFormContainer = document.getElementById('loginFormContainer');
            const uploadFormContainer = document.getElementById('uploadFormContainer');
            const loginForm = document.getElementById('loginForm');
            const uploadSermonForm = document.getElementById('uploadSermonForm');
            const loginMessage = document.getElementById('loginMessage');
            const uploadMessage = document.getElementById('uploadMessage');

            if (addSermonBtn) {
                addSermonBtn.addEventListener('click', () => {
                    // Reset form visibility and messages
                    loginFormContainer.style.display = 'block';
                    uploadFormContainer.style.display = 'none';
                    loginMessage.style.display = 'none';
                    uploadMessage.style.display = 'none';
                    loginForm.reset();
                    uploadSermonForm.reset();
                    CONFIG.currentUserRole = null; // Clear role on modal open

                    showModal('sermonAuthModal');
                });
            }

            if (loginForm) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const username = loginForm.username.value;
                    const password = loginForm.password.value;

                    loginMessage.style.display = 'none'; // Hide previous message

                    if (CONFIG.USERS[username] && CONFIG.USERS[username].password === password) {
                        CONFIG.currentUserRole = CONFIG.USERS[username].role;
                        loginMessage.textContent = `¡Bienvenido, ${CONFIG.USERS[username].name}!`;
                        loginMessage.classList.remove('danger');
                        loginMessage.classList.add('success', 'show');

                        // Simulate loading for better UX
                        showFullScreenLoading(true);
                        setTimeout(() => {
                            showFullScreenLoading(false);
                            loginFormContainer.style.display = 'none';
                            uploadFormContainer.style.display = 'block';
                            // Optional: Pre-fill preacher field if user is a known preacher
                            if (username === 'admin' || username === 'editor') {
                                uploadSermonForm.sermonPreacher.value = (username === 'admin') ? 'Pastor Juan Pérez' : 'Pastora María Gómez';
                            }
                            uploadMessage.style.display = 'none'; // Ensure upload message is hidden
                        }, 1000); // Simulate login delay
                    } else {
                        loginMessage.textContent = 'Usuario o contraseña incorrectos.';
                        loginMessage.classList.remove('success');
                        loginMessage.classList.add('danger', 'show');
                    }
                });
            }

            if (uploadSermonForm) {
                uploadSermonForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    uploadMessage.style.display = 'none'; // Hide previous message

                    if (CONFIG.currentUserRole !== 'administrator' && CONFIG.currentUserRole !== 'editor') {
                        uploadMessage.textContent = 'No tienes permisos para subir predicaciones.';
                        uploadMessage.classList.remove('success');
                        uploadMessage.classList.add('danger', 'show');
                        return;
                    }

                    showFullScreenLoading(true);

                    // Simulate upload process
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    const newSermon = {
                        id: `sermon${sermonsData.length + 1}`, // Simple ID generation
                        title: uploadSermonForm.sermonTitle.value,
                        preacher: uploadSermonForm.sermonPreacher.value,
                        date: uploadSermonForm.sermonDate.value,
                        area: uploadSermonForm.sermonArea.value,
                        link: uploadSermonForm.sermonLink.value,
                        description: uploadSermonForm.sermonDescription.value || "Sin descripción."
                    };

                    sermonsData.unshift(newSermon); // Add to the beginning of the array (latest first)
                    sermonsData.sort((a, b) => new Date(b.date) - new Date(a.date)); // Re-sort by date

                    showFullScreenLoading(false);
                    uploadMessage.textContent = '¡Predicación subida con éxito! (Nota: Solo demo, no se guarda de forma persistente)';
                    uploadMessage.classList.remove('danger');
                    uploadMessage.classList.add('success', 'show');

                    uploadSermonForm.reset();
                    hideModal('sermonAuthModal'); // Close modal after successful upload

                    // Re-render sermons and update filters
                    populateFilterOptions();
                    applySermonFilters();
                });
            }
