
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iglesia Cruzada Cristiana</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <style>
  </style>
</head>
<body>
  <div id="churchModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <button class="close-button" id="closeModalButton">×</button>
      <h2><i class="fas fa-cross me-3"></i> Nuestras Sedes <i class="fas fa-cross ms-3"></i></h2>

      <div class="modal-controls">
        <div class="d-flex align-items-center gap-3 w-100">
          <label for="sede-selector" class="form-label mb-0 flex-shrink-0">Selecciona una Sede:</label>
          <select id="sede-selector" class="form-select flex-grow-1"></select>
        </div>
        <button id="locateMeBtn" class="btn btn-success">
          <i class="fas fa-location-crosshairs"></i> Ubicarme
        </button>
      </div>

      <div id="geolocationMessage" class="geolocation-message"></div>
      <div id="churchDetailsContainer"></div>
    </div>
  </div>

  <script>
    const sedes = [
      {
        id: "victoria",
        nombre: "La Victoria Cruzada Cristiana",
        pastores: "Rodrigo Castrillón y Rosalba Perez",
        direccion: "Av7 #3 - 80",
        ciudad: "Cúcuta, Norte de Santander",
        telefono: "(123) 456-7890",
        email: "victoria@iglesia.com",
        horarios: ["Domingos: 7:00 AM, 9:00 AM, 11:00 AM y 5:00 PM", "Miércoles: 6:00 PM"],
        enlaceMapa: "https://maps.app.goo.gl/KLdE18eimYx5ykQZ6",
        lat: 7.905052,
        lng: -72.514113
      },
      {
        id: "belen",
        nombre: "Cristiano Belén",
        pastores: "Juan Pérez y Ana Torres",
        direccion: "Anillo Vial Oriental Av 12 No. 8-105",
        ciudad: "Cúcuta, Norte de Santander",
        telefono: "(123) 456-7892",
        email: "belen@iglesia.com",
        horarios: ["Domingos: 7:00 AM, 9:00 AM, 11:00 AM y 5:00 PM", "Miércoles: 6:00 PM"],
        enlaceMapa: "https://maps.app.goo.gl/U2D3E4F5G6H7I8J90",
        lat: 7.859660,
        lng: -72.519500
      }
    ];

    let userCoordinates = null;

    function haversineDistance(c1, c2) {
      const R = 6371e3;
      const φ1 = c1.lat * Math.PI / 180;
      const φ2 = c2.lat * Math.PI / 180;
      const Δφ = (c2.lat - c1.lat) * Math.PI / 180;
      const Δλ = (c2.lng - c1.lng) * Math.PI / 180;

      const a = Math.sin(Δφ/2) ** 2 + Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ/2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function calcularTiempoDistancia(coords) {
      const distancia = haversineDistance(userCoordinates, coords);
      const km = (distancia / 1000).toFixed(2);
      const tiempo = Math.round((distancia / 1000) / 40 * 60);
      return { distancia: `${km} km`, tiempo: `${tiempo} min` };
    }

    function renderizarSede(sede) {
      const cont = document.getElementById("churchDetailsContainer");
      cont.innerHTML = `
        <div class="church-details active">
          <h3><i class="fas fa-church"></i> ${sede.nombre}</h3>
          <div class="info-grid">
            <div class="info-item"><i class="fas fa-user"></i><p><strong>Pastores:</strong> ${sede.pastores}</p></div>
            <div class="info-item"><i class="fas fa-route"></i><p><strong>Dirección:</strong> ${sede.direccion}</p></div>
            <div class="info-item"><i class="fas fa-map-marker-alt"></i><p><strong>Ciudad:</strong> ${sede.ciudad}</p></div>
            <div class="info-item"><i class="fas fa-phone-alt"></i><p><strong>Teléfono:</strong> ${sede.telefono}</p></div>
            <div class="info-item"><i class="fas fa-envelope"></i><p><strong>Email:</strong> ${sede.email}</p></div>
            <div class="info-item"><i class="fas fa-clock"></i><p><strong>Horarios:</strong>
              <ul>${sede.horarios.map(h => `<li>${h}</li>`).join("")}</ul></p>
            </div>
            <div class="info-item tiempo-distancia" id="tiempoDistancia" style="display:none;"></div>
          </div>
          <a href="${sede.enlaceMapa}" target="_blank" class="map-link">Ver en Google Maps <i class="fas fa-external-link-alt"></i></a>
          <div id="map-${sede.id}" class="map-container">Mapa aquí</div>
        </div>`;

      if (userCoordinates) {
        const tElem = document.getElementById("tiempoDistancia");
        const info = calcularTiempoDistancia({ lat: sede.lat, lng: sede.lng });
        tElem.innerHTML = `<i class="fas fa-route me-2"></i><strong>Distancia:</strong> ${info.distancia}, <strong>Tiempo:</strong> ${info.tiempo}`;
        tElem.style.display = "flex";
      }
    }

    function mostrarSedeSeleccionada() {
      const id = document.getElementById("sede-selector").value;
      const sede = sedes.find(s => s.id === id);
      if (sede) renderizarSede(sede);
    }

    function llenarSelectorSedes() {
      const selector = document.getElementById("sede-selector");
      selector.innerHTML = '<option selected disabled value="">Selecciona una Sede...</option>';
      sedes.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.id;
        opt.textContent = s.nombre;
        selector.appendChild(opt);
      });
    }

    function buscarSedeCercana() {
      navigator.geolocation.getCurrentPosition(pos => {
        userCoordinates = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        let minDist = Infinity;
        let masCercana = null;
        sedes.forEach(s => {
          const dist = haversineDistance(userCoordinates, { lat: s.lat, lng: s.lng });
          if (dist < minDist) {
            minDist = dist;
            masCercana = s;
          }
        });
        if (masCercana) {
          document.getElementById("sede-selector").value = masCercana.id;
          renderizarSede(masCercana);
        }
      });
    }

    window.openChurchModal = function () {
      document.getElementById("churchModal").style.display = "flex";
      llenarSelectorSedes();
      document.getElementById("sede-selector").onchange = mostrarSedeSeleccionada;
      document.getElementById("locateMeBtn").onclick = buscarSedeCercana;
      document.getElementById("closeModalButton").onclick = () => {
        document.getElementById("churchModal").style.display = "none";
      };
    };

    document.addEventListener("DOMContentLoaded", () => {
      if (document.getElementById("openChurchModalBtn")) {
        document.getElementById("openChurchModalBtn").onclick = () => openChurchModal();
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
